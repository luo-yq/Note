amqp协议适合性能高的设备
mqtt适合嵌入式这类性能要求不高的设备



1.centos7中安装RabbitMQ
1).首先需要安装erlang
yum -y install erlang
2).完成后安装RabbitMQ：
先下载rpm：
wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.6.6/rabbitmq-server-3.6.6-1.el7.noarch.rpm
yum -y install rabbitmq-server-3.6.6-1.el7.noarch.rpm 

#启动后台管理插件
rabbitmq-plugins enable rabbitmq_management   
#web监控插件
rabbitmq-plugins enable rabbitmq_tracing
# 安装mqtt插件
rabbitmq-plugins enable rabbitmq_mqtt 



#添加用户和权限
#默认网页guest用户是不允许访问的，需要增加一个用户修改一下权限，代码如下：
#添加用户:
rabbitmqctl add_user admin admin
#添加权限:
rabbitmqctl set_permissions -p "/" admin ".*" ".*" ".*"
#修改用户角色:
rabbitmqctl set_user_tags admin administrator

#启动
rabbitmq-server start &
#停止
rabbitmqctl stop 



firewall-cmd --zone=public --add-port=15672/tcp --permanent
firewall-cmd --zone=public --add-port=5672/tcp --permanent
firewall-cmd --zone=public --add-port=1883/tcp --permanent
firewall-cmd --reload

rabbitmq-server -detached   #后台运行rabbitmq  
rabbitmqctl stop 停止服务器


修改端口和配置支持外网
vi /etc/rabbitmq/rabbitmq.config
分别配置web界面端口15672和amqp协议端口5672,mqtt协议端口1883
[
{rabbitmq_management, [{listener, [{port, 15672}, {ip, "0.0.0.0"}, {ssl, false}]}]},
{rabbit, [{tcp_listeners, [5672]}, {loopback_users, ["admin"]}]},
{rabbitmq_mqtt, [{default_user,     <<"guest">>},
                  {default_pass,     <<"guest">>},
                  {allow_anonymous,  true},
                  {vhost,            <<"/">>},
                  {exchange,         <<"amq.topic">>},
                  {subscription_ttl, 1800000},
                  {prefetch,         10},
                  {ssl_listeners,    []},
                  %% Default MQTT with TLS port is 8883
                  %% {ssl_listeners,    [8883]}
                  {tcp_listeners,    [1883]},
                  {tcp_listen_options, [{backlog,   128},
                                        {nodelay,   true}]}]}
].


ip:15672/#/

 



手动安装Erlang

yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel openssl-devel  
yum -y install ncurses-devel  
wget http://erlang.org/download/otp_src_18.2.1.tar.gz  
tar xvfz otp_src_18.2.1.tar.gz   
cd opt_src_18.2.1
./configure   
make install  

安装rabbitmq
wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.6.9/rabbitmq-server-generic-unix-3.6.9.tar.xz      
yum install xz  
xz -d xz -d rabbitmq-server-generic-unix-3.6.9.tar.xz  
tar -xvf rabbitmq-server-generic-unix-3.6.9.tar 

cp -r rabbitmq_server-3.6.9 /usr/local/rabbitmq  

vi /etc/profile  
export PATH=/usr/local/rabbitmq/sbin:$PATH     
source /etc/profile

 
















